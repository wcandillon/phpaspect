<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><title>Chapter 2. Hello world</title><link rel="stylesheet" href="docbook.css" type="text/css"></link><meta name="generator" content="DocBook XSL Stylesheets V1.71.0"></meta><link rel="start" href="index.html" title="phpAspect documentation"></link><link rel="up" href="index.html" title="phpAspect documentation"></link><link rel="prev" href="aop.html" title="Chapter 1. Aspect-Oriented Programming"></link><link rel="next" href="install.html" title="Chapter 3. Installing phpAspect"></link><script xmlns="" src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script><script xmlns="" type="text/javascript">
    _uacct = "UA-259974-1";
    urchinTracker();
    </script></head><body><a xmlns="" href="http://phpaspect.org"><img src="http://phpaspect.org/images/phpaspect.png" alt="phpAspect Logo" style="border:0;"></a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 2. Hello world</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="aop.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="install.html">Next</a></td></tr></table><hr></hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="helloworld"></a>Chapter 2. Hello world</h2></div></div></div><p>
    Consider a virtual cart application : There is only two classes:
    the Order which contains items and the Catalog class which contains
    all purchasable items. The following code is very simple.
  </p><div class="example"><a id="intro.examples.virtual-cart1.php"></a><p class="title"><b>Example 2.1: A virtual cart</b></p><div class="example-contents"><pre class="programlisting"><code><span class="default">&lt;?php</span><br /><span class="keyword">class</span><span class="default">&nbsp;</span><span class="default">Order</span><span class="keyword">{</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">private</span><span class="default">&nbsp;</span><span class="default">$items</span><span class="default">&nbsp;</span><span class="keyword">=</span><span class="default">&nbsp;</span><span class="keyword">array</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span><span class="default">&nbsp;&nbsp;</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">private</span><span class="default">&nbsp;</span><span class="default">$amount</span><span class="default">&nbsp;</span><span class="keyword">=</span><span class="default">&nbsp;</span><span class="default">0</span><span class="keyword">;</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">public</span><span class="default">&nbsp;</span><span class="keyword">function</span><span class="default">&nbsp;</span><span class="default">addItem</span><span class="keyword">(</span><span class="default">$reference</span><span class="keyword">,</span><span class="default">&nbsp;</span><span class="default">$quantity</span><span class="keyword">)</span><span class="keyword">{</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">items</span><span class="keyword">[</span><span class="keyword">]</span><span class="default">&nbsp;</span><span class="keyword">=</span><span class="default">&nbsp;</span><span class="keyword">array</span><span class="keyword">(</span><span class="default">$reference</span><span class="keyword">,</span><span class="default">&nbsp;</span><span class="default">$quantity</span><span class="keyword">)</span><span class="keyword">;</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">amount</span><span class="default">&nbsp;</span><span class="default">+=</span><span class="default">&nbsp;</span><span class="default">$quantity</span><span class="keyword">*</span><span class="default">Catalog</span><span class="keyword">::</span><span class="default">getPrice</span><span class="keyword">(</span><span class="default">$reference</span><span class="keyword">)</span><span class="keyword">;</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">}</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">public</span><span class="default">&nbsp;</span><span class="keyword">function</span><span class="default">&nbsp;</span><span class="default">getAmount</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">{</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">return</span><span class="default">&nbsp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">amount</span><span class="keyword">;</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">}</span><br /><span class="keyword">}</span><br />&nbsp;<br /><span class="keyword">class</span><span class="default">&nbsp;</span><span class="default">Catalog</span><span class="keyword">{</span><br /><span class="default">&nbsp;&nbsp;</span><span class="keyword">private</span><span class="default">&nbsp;</span><span class="keyword">static</span><span class="default">&nbsp;</span><span class="default">$priceList</span><span class="default">&nbsp;</span><span class="keyword">=</span><span class="default">&nbsp;</span><span class="keyword">array</span><span class="keyword">(</span><span class="string">'Largo&nbsp;Winch'</span><span class="default">&nbsp;</span><span class="keyword">=&gt;</span><span class="default">&nbsp;</span><span class="default">9.31</span><span class="keyword">,</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string">'Asterix'</span><span class="default">&nbsp;</span><span class="keyword">=&gt;</span><span class="default">&nbsp;</span><span class="default">8.46</span><span class="keyword">,</span><span class="default">&nbsp;</span><span class="string">'XIII'</span><span class="default">&nbsp;</span><span class="keyword">=&gt;</span><span class="default">&nbsp;</span><span class="default">8.70</span><span class="keyword">)</span><span class="keyword">;</span><br />&nbsp;<br /><span class="default">&nbsp;&nbsp;</span><span class="keyword">public</span><span class="default">&nbsp;</span><span class="keyword">static</span><span class="default">&nbsp;</span><span class="keyword">function</span><span class="default">&nbsp;</span><span class="default">getPrice</span><span class="keyword">(</span><span class="default">$reference</span><span class="keyword">)</span><span class="keyword">{</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">return</span><span class="default">&nbsp;</span><span class="default">self</span><span class="keyword">::</span><span class="default">$priceList</span><span class="keyword">[</span><span class="default">$reference</span><span class="keyword">]</span><span class="keyword">;</span><br /><span class="default">&nbsp;&nbsp;</span><span class="keyword">}</span><br /><span class="keyword">}</span><br />&nbsp;<br /><span class="default">$myOrder</span><span class="default">&nbsp;</span><span class="keyword">=</span><span class="default">&nbsp;</span><span class="keyword">new</span><span class="default">&nbsp;</span><span class="default">Order</span><span class="keyword">;</span><br /><span class="default">$myOrder</span><span class="keyword">-&gt;</span><span class="default">addItem</span><span class="keyword">(</span><span class="string">'Largo&nbsp;Winch'</span><span class="keyword">,</span><span class="default">&nbsp;</span><span class="default">1</span><span class="keyword">)</span><span class="keyword">;</span><br /><span class="default">$myOrder</span><span class="keyword">-&gt;</span><span class="default">addItem</span><span class="keyword">(</span><span class="string">'Asterix'</span><span class="keyword">,</span><span class="default">&nbsp;</span><span class="default">2</span><span class="keyword">)</span><span class="keyword">;</span><br /><span class="default">?&gt;</span><br /></code></pre></div></div><br class="example-break"></br><p>
      However, in a real-world shopping application, this transfer method
      seems far from adequate. The cart need to be persistent, we must check
      if the entered references are correct, if the user is properly authenticated.
      Finally, we must log the operation to the system log. And so on.
      Not only all these crosscutting concerns would polluate our previous source code 
      in term of code modularization but it also would make code evolution
      very diffucult: If you want to add a crosscutting concerns into a small
      php application (about 200 classes for instance), you would have to review
      manually each method from your 200 classes. 
    </p><p>
      So we want to add crosscutting concerns to our virtual cart without touching
      the previous listing. First technical
        concern a logging aspect : we would like to log every item added and then the total
        amound of the command. 
      </p><div class="example"><a id="intro.examples.logging-aspect.php"></a><p class="title"><b>Example 2.2: A Logging aspect</b></p><div class="example-contents"><pre class="programlisting"><code><span class="default">&lt;?php</span><br /><span class="default">aspect</span><span class="default">&nbsp;</span><span class="default">TraceOrder</span><span class="keyword">{</span><br />&nbsp;<br /><span class="default">&nbsp;&nbsp;</span><span class="default">pointcut</span><span class="default">&nbsp;</span><span class="default">logAddItem</span><span class="keyword">:</span><span class="default">exec</span><span class="keyword">(</span><span class="keyword">public</span><span class="default">&nbsp;</span><span class="default">Order</span><span class="keyword">::</span><span class="default">addItem</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span><br /><span class="default">&nbsp;&nbsp;</span><span class="default">pointcut</span><span class="default">&nbsp;</span><span class="default">logTotalAmount</span><span class="keyword">:</span><span class="default">call</span><span class="keyword">(</span><span class="default">Order</span><span class="keyword">-&gt;</span><span class="default">addItem</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span><br />&nbsp;<br /><span class="default">&nbsp;&nbsp;</span><span class="default">after</span><span class="keyword">(</span><span class="default">$quantity</span><span class="keyword">,</span><span class="default">&nbsp;</span><span class="default">$reference</span><span class="keyword">)</span><span class="keyword">:</span><span class="default">&nbsp;</span><span class="default">logAddItem</span><span class="keyword">{</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">printf</span><span class="keyword">(</span><span class="string">&quot;%d&nbsp;%s&nbsp;added&nbsp;to&nbsp;the&nbsp;cart\n&quot;</span><span class="keyword">,</span><span class="default">&nbsp;</span><span class="default">$quantity</span><span class="keyword">,</span><span class="default">&nbsp;</span><span class="default">$reference</span><span class="keyword">)</span><span class="keyword">;</span><br /><span class="default">&nbsp;&nbsp;</span><span class="keyword">}</span><br />&nbsp;<br /><span class="default">&nbsp;&nbsp;</span><span class="default">after</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span><span class="default">&nbsp;</span><span class="default">logTotalAmount</span><span class="keyword">{</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">printf</span><span class="keyword">(</span><span class="string">&quot;Total&nbsp;amount&nbsp;of&nbsp;the&nbsp;cart&nbsp;:&nbsp;%.2f&nbsp;euros\n&quot;</span><span class="keyword">,</span><br /><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="default">$thisJoinPoint</span><span class="keyword">-&gt;</span><span class="default">getObject</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">-&gt;</span><span class="default">getAmount</span><span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span><br /><span class="default">&nbsp;&nbsp;</span><span class="keyword">}</span><br /><span class="keyword">}</span><br /><span class="default">?&gt;</span><br /></code></pre></div></div><br class="example-break"></br><p>
          After weaving, the execution result is the following :
        </p><div class="example"><a id="intro.examples.logging-aspect.php"></a><p class="title"><b>Example 2.3: The result</b></p><div class="example-contents"><pre class="programlisting"><code>
2 Largo Winch added to the cart.
Total amount of the cart: 18.62 euros
1 Asterix added to the cart.
Total amount of the cart: 27.08 euros
</code></pre></div></div><br class="example-break"></br></div><div class="navfooter"><hr></hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="aop.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="install.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 1. Aspect-Oriented Programming </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 3. Installing phpAspect</td></tr></table></div><div xmlns="" class="copyright-notice"><a href="appendixes.copyright.html">Copyright</a> © 2006-2007 <a href="mailto:wcandillon@elv.telecom-lille1.eu">William Candillon</a>
      and <a href="mailto:vanwormhoudt@telecom-lille1.eu">Gilles Vanwormhoudt</a>.
    </div></body></html>
